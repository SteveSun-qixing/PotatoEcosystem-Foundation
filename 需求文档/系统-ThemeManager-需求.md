# 主题管理器 - 需求文档

## 模块定位

主题管理器是公共基础层的系统服务组件，负责整个薯片生态的主题登记、存储和分发。系统维护一个全局的主题注册表，记录所有已安装的主题包信息，为生态中的编辑引擎、查看器及其他软件提供统一的主题查询和获取服务。

主题管理器只负责主题包的管理，不负责主题的应用。主题如何应用到组件上由各个软件和插件自行实现，主题管理器只提供主题包的存储、查询和获取能力。这种职责分离让主题管理器保持简洁，专注于管理这一单一职责，也让主题应用逻辑可以根据不同软件的需求灵活实现。

## 功能需求

支持全局主题的登记和管理。主题管理器启动时扫描主题目录，读取每个主题包的配置文件，建立主题注册表。注册表记录每个主题的 ID、名称、版本、发行商、存储路径等信息，提供快速查询能力。用户安装新主题时，系统将主题包添加到主题目录，更新注册表。用户卸载主题时，系统从注册表移除记录，删除主题包文件。

支持主题包的存储和分发。主题包存储在用户的本地主题目录中，目录结构按照发行商组织，每个发行商一个子目录。主题包是一个独立的文件夹，包含配置文件、样式文件和可选的资源文件。配置文件记录主题的基本信息，样式文件使用 CSS 格式定义视觉属性，资源文件包含图片、图标等装饰性内容。

支持主题的查询和获取。生态软件通过主题管理器查询可用主题列表，获取每个主题的基本信息，构建主题选择界面。查询时可以指定过滤条件，如只查询支持某种组件类型的主题，或只查询某个发行商的主题。软件应用主题时，向主题管理器请求主题包的样式内容，系统支持按需获取特定组件类型的样式，减少数据传输量。

支持默认主题管理。系统内置一个默认主题，提供简洁通用的视觉风格，确保在用户没有安装任何主题包时所有组件都能正常显示。默认主题存储在系统目录中，用户不能卸载或修改。当请求的主题不存在或所有层级的主题配置都为空时，系统返回默认主题作为兜底。

支持用户自定义主题的加载。用户可以从应用市场下载主题包，也可以直接导入本地的主题包文件。安装过程中系统验证主题包的格式，检查配置文件是否完整，样式文件是否有效。验证通过后将主题包复制到主题目录，更新注册表。系统支持主题的版本更新，安装新版本时自动替换旧版本。

## 接口需求

提供主题列表查询接口，返回所有已注册主题的信息数组。接口支持过滤参数，可按发行商、组件类型等条件筛选。

提供主题详情查询接口，接收主题 ID，返回该主题的完整配置信息，包括支持的组件类型、CSS 变量定义、资源文件列表等。

提供主题内容获取接口，接收主题 ID 和可选的组件类型参数。返回主题的样式内容，如果指定了组件类型则只返回该组件的样式。

提供主题安装接口，接收主题包文件路径或主题包目录路径。接口验证主题包格式，安装到主题目录，更新注册表，返回安装结果。

提供主题卸载接口，接收主题 ID。接口从注册表移除主题记录，删除主题包文件夹，返回卸载结果。

提供资源路径解析接口，接收主题 ID 和资源相对路径，返回资源的实际文件路径，方便软件加载主题中的图片图标。

## 非功能需求

主题注册表的查询要快速，使用内存缓存避免频繁读取文件系统。主题目录扫描要高效，支持增量更新，只扫描发生变化的部分。主题内容获取要支持按需加载，不需要一次性加载整个主题包。安装和卸载操作要可靠，失败时能回滚，不留下残余文件。默认主题要稳定可靠，作为整个主题系统的兜底保障。
