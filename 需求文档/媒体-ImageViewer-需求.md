# 图片查看器 - 需求文档

## 模块定位

图片查看器是公共基础层的核心媒体组件,为整个生态提供图片显示和基础操作能力。图片卡片、图文卡片、封面显示等需要展示图片的场景通过这个模块实现。它是一个可以被其他模块调用的查看组件,而不是独立的图片管理应用。

这个模块封装了图片加载、显示、缩放、旋转等功能,对外提供简洁统一的接口。插件开发者只需要传入图片文件路径和显示参数,就能在界面中显示图片,并提供用户友好的查看交互。

图片查看器通过微内核的路由系统对外提供服务,支持多实例,可以同时显示多张图片或在不同位置显示图片。每个查看器实例独立工作,有自己的显示状态和控制接口。

## 功能需求

### 图片格式支持

支持常见的图片格式,包括JPEG、PNG、GIF、WebP、SVG、BMP、TIFF等。支持静态图片和动态图片,GIF动图要正常播放动画。

支持不同颜色深度和透明度的图片。PNG支持透明背景,SVG支持矢量图形的清晰缩放。

对于不支持的格式,给出明确的错误提示,告诉用户哪种格式不支持,建议转换格式或使用其他查看器。

### 图片显示模式

提供多种图片适配模式,适应不同的显示需求。包含模式保持图片完整显示,自动调整大小使图片完全显示在容器中,不裁剪不变形。覆盖模式填充整个容器,图片可能被裁剪,但不变形。填充模式拉伸图片填充容器,可能变形。原始尺寸模式按图片原本大小显示,不缩放。

适配模式可以在运行时切换,用户根据需要选择合适的模式。适配模式变化时,图片平滑过渡到新的显示状态。

### 缩放功能

支持图片的缩放操作。可以放大查看细节,可以缩小看整体。缩放范围从10%到1000%,小图可以放大看像素,大图可以缩小看全貌。

支持多种缩放方式。双击图片自动缩放到合适大小或恢复原始大小。鼠标滚轮向上放大向下缩小。触摸屏双指捏合缩放。提供缩放按钮,点击逐级放大或缩小。

缩放时保持图片中心不变,或保持鼠标指向的位置不变。缩放动画平滑自然,不突兀。缩放到边界时给出视觉或触觉反馈。

### 平移功能

当图片大于容器时,支持拖动平移查看图片的不同部分。鼠标拖动或触摸滑动移动图片。平移要流畅,跟手性好,延迟低。

平移时不能超出边界,图片边缘到达容器边缘后不能继续平移。或者允许稍微超出,释放后弹回,提供橡皮筋效果。

平移状态要记忆,下次打开同一图片时,恢复到上次的平移位置和缩放级别。

### 旋转功能

支持图片旋转,可以顺时针或逆时针旋转90度、180度、270度。旋转后图片适配到容器,保持完整显示。

提供旋转按钮或快捷键,快速旋转图片。旋转动画平滑,不闪烁。旋转状态持久化保存,下次打开时保持旋转状态。

### 全屏查看

支持全屏查看模式,点击全屏按钮或双击图片进入全屏。全屏时图片占据整个屏幕,背景变暗,隐藏其他界面元素。

全屏时仍然支持缩放、平移、旋转操作。按ESC键或点击关闭按钮退出全屏,返回正常显示模式。

### 多图浏览

当有多张图片时,支持切换浏览。提供上一张下一张按钮,点击切换图片。支持键盘左右箭头切换。

支持缩略图导航,显示所有图片的缩略图,点击缩略图跳转到对应图片。缩略图可以滚动,容纳大量图片。

切换图片时,可以预加载相邻图片,提高切换速度。切换动画平滑,可以是淡入淡出或滑动切换。

### 图片信息显示

显示图片的基本信息,包括文件名、尺寸、大小、格式、拍摄日期等。信息从图片的EXIF元数据读取。

提供信息面板,点击按钮显示详细信息。信息面板可以关闭,不影响图片查看。信息要准确,格式要友好,尺寸用易读的单位表示。

### 图片操作

提供基础的图片操作功能。可以复制图片到剪贴板,可以另存为到指定位置,可以设置为桌面壁纸或锁屏壁纸。

可以在文件管理器中显示图片位置,可以用系统默认应用打开图片,可以删除图片。

操作要有确认提示,避免误操作。操作失败给出明确的错误信息。

### 加载和缓存

图片加载要快速,优先加载当前查看的图片,延迟加载其他图片。显示加载进度,大图片加载时显示进度条或加载动画。

图片加载失败时,显示占位图或错误提示,告诉用户加载失败的原因。提供重试按钮,用户可以重新加载。

已加载的图片缓存起来,避免重复加载。缓存要有大小限制,超过限制时清理最久未使用的图片。

### 动图控制

GIF动图自动播放动画,可以暂停和继续播放。可以控制播放速度,慢速播放或快速播放。可以逐帧播放,精确查看每一帧。

动图循环播放,或播放一次后停止,根据配置决定。动图性能要优化,不能因为播放动图导致界面卡顿。

## 接口需求

### 查看器创建接口

提供创建查看器实例的接口,传入容器元素和初始配置。配置包括图片源、显示模式、是否显示控制按钮等。返回查看器实例标识。

### 加载图片接口

提供加载图片的接口,传入图片路径或URL。支持加载单张图片或多张图片列表。

### 显示控制接口

提供设置显示模式、缩放、旋转、平移等控制接口。提供进入退出全屏的接口。

### 导航接口

提供切换到上一张下一张图片的接口,提供跳转到指定图片的接口。

### 状态查询接口

提供查询当前显示的图片、缩放级别、旋转角度、平移位置等状态信息的接口。

### 事件监听接口

提供监听查看器事件的接口。事件包括图片加载完成、图片加载失败、缩放变化、旋转变化、切换图片等。

### 销毁接口

提供销毁查看器实例的接口,释放资源,清理内存。

## 非功能需求

### 性能要求

图片加载要快速,小图片立即显示,大图片渐进加载。缩放平移要流畅,操作响应延迟不超过100毫秒。切换图片要快速,预加载机制减少等待时间。

内存占用要合理,查看大量图片不会占用过多内存。不再查看的图片及时清理,避免内存泄漏。

### 显示质量要求

图片显示要清晰,缩放时使用高质量插值算法,避免锯齿和模糊。小图放大时尽可能保持清晰,大图缩小时不丢失细节。

颜色还原要准确,支持色彩管理,正确显示不同色彩空间的图片。透明图片的透明区域正确显示。

### 兼容性要求

支持各种常见图片格式,满足用户的查看需求。在不同平台上保持一致的功能和体验。

### 用户体验要求

界面要简洁直观,控制元素清晰易用。操作要流畅,响应及时,交互自然。错误提示要友好,帮助用户解决问题。
