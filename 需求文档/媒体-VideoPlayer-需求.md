# 视频播放器 - 需求文档

## 模块定位

视频播放器是公共基础层的核心媒体组件,为整个生态提供视频播放能力。薯片生态中的视频卡片、剧集卡片等需要播放视频的场景,都通过这个模块实现。它不是一个独立的播放器应用,而是一个可以被其他模块调用的播放组件。

这个模块封装了视频解码、渲染、控制等底层能力,对外提供简洁统一的接口。插件开发者不需要了解视频编解码的复杂细节,只需要传入视频文件路径和播放参数,就能在界面中显示视频播放器。

视频播放器通过微内核的路由系统对外提供服务,所有对播放器的调用都经过内核。它支持多实例,可以同时播放多个视频,每个播放器实例独立工作,互不干扰。

## 功能需求

### 视频格式支持

支持常见的视频格式,包括MP4、WebM、AVI、MKV、MOV等。支持主流的视频编码,包括H.264、H.265、VP8、VP9、AV1等。支持多种音频编码,包括AAC、MP3、Opus、Vorbis等。

对于不支持的格式,给出明确的错误提示,告诉用户哪种格式不支持,建议使用的格式。不能静默失败,也不能崩溃。

### 播放控制

提供完整的播放控制功能。支持播放和暂停,点击播放按钮开始播放,再次点击暂停。支持停止,停止后回到视频开头。支持快进和快退,可以跳转到视频的任意位置。

支持播放速度调节,可以慢速播放或快速播放。常用速度有0.5倍、0.75倍、1倍、1.25倍、1.5倍、2倍。支持帧进帧退,用于精确定位视频画面。

支持循环播放,视频播放完毕后自动从头开始。支持播放列表,播放完当前视频自动播放下一个。

### 音量控制

提供音量调节功能,用户可以调整播放音量。音量范围从0到100,0是静音,100是最大音量。支持静音切换,点击静音按钮快速静音或取消静音。

音量控制要同步到系统音量,或者使用独立的音量。提供音量记忆功能,记住用户上次设置的音量,下次打开时恢复。

支持音频轨道切换,当视频包含多个音频轨道时,用户可以选择听哪个轨道。比如电影包含中文和英文两个音轨,用户可以切换。

### 字幕支持

支持加载和显示字幕。字幕格式支持SRT、VTT、ASS等常见格式。字幕可以嵌入在视频文件中,也可以是外部字幕文件。

支持多字幕切换,当视频有多个字幕时,用户可以选择显示哪个字幕。支持字幕开关,可以完全关闭字幕显示。

字幕样式可以自定义,包括字体大小、颜色、背景色、位置等。字幕位置可以上下调整,避免遮挡重要画面。

### 全屏模式

支持全屏播放,点击全屏按钮进入全屏,视频占据整个屏幕。全屏时隐藏其他界面元素,只显示视频和控制条。按ESC键或点击退出全屏按钮退出全屏。

支持画中画模式,视频在小窗口中播放,窗口浮在其他内容之上。用户可以一边看视频一边操作其他内容。画中画窗口可以调整大小和位置。

### 进度记忆

记忆视频的播放进度,用户下次打开同一视频时,从上次停止的位置继续播放。进度记忆要持久化保存,应用重启后仍然有效。

对于短视频,可以不记忆进度,每次从头播放。对于长视频,进度记忆很重要,避免用户重复观看已看过的内容。

提供跳过片头片尾的功能,自动识别片头片尾,播放时自动跳过。用户也可以手动设置跳过的时间段。

### 视频信息显示

显示视频的基本信息,包括时长、分辨率、码率、帧率等。显示当前播放进度,包括已播放时长和总时长。

提供视频质量调节,当视频有多个清晰度版本时,用户可以选择清晰度。比如720p、1080p、4K等。根据网络情况自动选择合适的清晰度。

### 缩略图预览

支持进度条缩略图预览,鼠标悬停在进度条上时,显示该位置的视频画面缩略图。这帮助用户快速定位到想看的位置。

缩略图可以提前生成,也可以实时提取。提前生成缩略图存储开销大,但预览快速。实时提取节省存储,但需要解码开销。

### 手势和快捷键

支持手势操作,在触摸屏设备上提供直观的手势控制。左右滑动快进快退,上下滑动调节音量或亮度,双击暂停或播放。

支持键盘快捷键,空格键播放暂停,左右箭头快进快退,上下箭头调节音量,F键全屏,M键静音。快捷键要可以自定义。

## 接口需求

### 播放器创建接口

提供创建播放器实例的接口,传入容器元素和初始配置。配置包括视频源、是否自动播放、是否显示控制条、音量等。返回播放器实例标识。

### 播放控制接口

提供播放、暂停、停止、跳转到指定位置、调整播放速度等控制接口。接口接收播放器标识和参数,执行对应操作。

### 音量控制接口

提供设置音量、静音、取消静音、切换音频轨道等接口。

### 字幕控制接口

提供加载字幕、切换字幕、显示隐藏字幕、设置字幕样式等接口。

### 状态查询接口

提供查询播放状态的接口,返回当前是播放还是暂停,当前播放位置,总时长,音量等信息。

### 事件监听接口

提供监听播放器事件的接口。事件包括播放开始、播放暂停、播放结束、进度变化、错误发生等。订阅者注册回调函数,事件发生时被调用。

### 销毁接口

提供销毁播放器实例的接口,释放资源,清理内存。

## 非功能需求

### 性能要求

视频加载要快速,点击播放后一秒内开始播放。播放要流畅,不能卡顿,帧率稳定。快进快退要响应迅速,跳转到目标位置的延迟不超过一秒。

解码要高效,充分利用硬件加速。CPU占用要合理,不能因为播放视频导致系统卡顿。内存占用要控制,长时间播放不能出现内存泄漏。

### 兼容性要求

在不同平台上保持一致的功能和体验。Windows、macOS、Linux都能正常播放。在不同浏览器内核中正常工作。

### 稳定性要求

播放器要稳定运行,不能崩溃。即使视频文件有问题,也要优雅处理,给出错误提示。播放过程中网络中断,能够暂停并等待恢复。

### 用户体验要求

界面要简洁易用,控制元素清晰可见。响应要及时,点击按钮立即有反馈。错误提示要友好,告诉用户发生了什么问题,如何解决。
