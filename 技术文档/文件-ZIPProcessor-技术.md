# ZIP处理器 - 技术文档

## 架构设计

ZIP处理器基于成熟的ZIP库构建,使用JSZip、fflate或类似的库作为底层实现。这些库提供完整的ZIP处理能力,支持压缩、解压、读写。

零压缩率通过设置压缩级别为0实现,文件原样存储不压缩。这让卡片和箱子文件可以快速打包和解包,性能开销小。

流式处理使用流式API,边读取边处理,不需要一次性加载整个ZIP到内存。读取文件列表只解析中央目录,不读取文件内容。读取单个文件使用随机访问,直接定位到文件位置读取。

## 接口定义

创建ZIP接口接收文件列表和配置选项,配置包括输出路径、压缩级别等。接口遍历文件列表,将文件添加到ZIP,生成ZIP文件。

解压ZIP接口接收ZIP路径和输出目录,解析ZIP结构,提取所有文件到目录。读取文件列表接口解析中央目录,返回文件元数据数组。读取单个文件接口定位文件,读取内容,返回Buffer或字符串。

## 使用方式

卡片保存时,调用ZIP处理器创建.card文件。将配置文件夹、内容文件夹、资源文件打包成ZIP,使用零压缩率保证快速。

卡片加载时,调用ZIP处理器读取.card文件。解析文件列表,读取配置文件,按需读取资源文件。不需要解压整个包,直接从ZIP读取需要的文件。

## 技术细节

使用中央目录快速定位文件,ZIP格式在文件末尾存储中央目录,记录所有文件的位置。读取中央目录就能获取文件列表和偏移量,无需扫描整个文件。

使用ArrayBuffer和TypedArray处理二进制数据,高效解析ZIP结构。使用Web Workers处理大ZIP包,避免阻塞主线程。
