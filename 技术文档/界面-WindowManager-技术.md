# 窗口管理器 - 技术文档

## 架构设计

窗口管理器维护窗口注册表,记录所有窗口的元数据和状态。每个窗口有唯一ID,元数据包括标题、位置、大小、z-index等。

窗口使用绝对定位,position设置为fixed或absolute。窗口容器包含标题栏、内容区、调整大小手柄。标题栏可以拖动,手柄可以调整大小。

窗口层级使用z-index管理,激活窗口的z-index最大。点击窗口时更新z-index,将窗口提到最前。z-index从基础值开始递增,避免冲突。

窗口状态持久化使用本地存储,状态对象序列化为JSON保存。应用启动时从本地存储加载,恢复窗口到上次状态。

## 接口定义

创建窗口接口接收窗口配置,配置包括标题、初始位置、初始大小、是否可调整大小等。接口创建窗口DOM元素,添加到窗口容器,注册到窗口表,返回窗口ID。

控制接口接收窗口ID和操作类型,执行对应操作。移动更新窗口位置,调整大小更新窗口尺寸,最小化隐藏窗口,最大化填满屏幕,关闭销毁窗口。

查询接口接收窗口ID,返回窗口状态对象,包含位置、大小、是否最小化、是否最大化等信息。

## 使用方式

卡片编辑引擎创建卡片窗口时,调用窗口管理器创建窗口。窗口管理器返回窗口ID和窗口元素,编辑引擎在窗口元素中渲染卡片内容。

用户拖动窗口时,窗口管理器更新窗口位置,触发移动事件通知编辑引擎。用户关闭窗口时,触发关闭事件,编辑引擎保存卡片状态,然后销毁窗口。

## 技术细节

拖动实现,监听标题栏的mousedown事件,记录初始鼠标位置和窗口位置。监听document的mousemove事件,计算鼠标移动距离,更新窗口位置。监听mouseup事件,停止拖动。

调整大小实现,监听手柄的mousedown事件,记录初始位置和窗口尺寸。监听mousemove事件,计算尺寸变化,更新窗口尺寸。限制最小和最大尺寸,防止窗口过小或过大。

z-index管理,维护窗口栈,栈顶窗口z-index最大。点击窗口时,将窗口移到栈顶,更新所有窗口的z-index。z-index基础值从1000开始,每个窗口递增1。

分屏吸附,拖动窗口到屏幕边缘时,检测距离,距离小于阈值触发吸附。吸附到左边缘窗口占据左半屏,吸附到右边缘占据右半屏,吸附到角落占据四分之一屏。
