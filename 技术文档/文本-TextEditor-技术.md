# 文本编辑器 - 技术文档

## 架构设计

文本编辑器基于成熟的编辑器库构建,使用CodeMirror、Monaco Editor或Ace等库作为底层实现。这些库提供完整的编辑能力,包括语法高亮、自动补全、多光标等高级功能。

编辑器使用文档模型表示文本内容,模型是不可变的,每次编辑创建新的模型版本。这简化撤销重做的实现,每个版本对应一个历史状态。

编辑器视图负责渲染文档模型,将模型转换为DOM显示。视图只读取模型,不修改模型。用户操作通过控制器处理,控制器更新模型,视图响应模型变化重新渲染。

## 接口定义

创建编辑器接口接收容器元素和配置对象,配置包括语言模式、主题、是否只读、是否显示行号等。接口创建编辑器实例,初始化文档模型,渲染到容器,返回实例标识符。

设置内容接口接收文本字符串,创建新的文档模型,替换当前模型。获取内容接口返回当前文档模型的文本内容。

执行命令接口接收命令标识和参数,执行对应的编辑操作。命令包括撤销、重做、查找、替换、格式化等。

## 使用方式

文本卡片插件需要文本编辑能力时,通过微内核向文本编辑器发送创建请求。编辑器创建后,用户可以输入和编辑文本。

编辑器内容变化时,触发变化事件通知插件。插件监听事件,将最新内容保存到卡片配置文件,实现自动保存。

## 技术细节

使用虚拟滚动处理大文件,只渲染可见区域的行,视口外的行不渲染。使用分块文档模型,将文档分成多个块,编辑只影响相关块,不需要重建整个文档。

使用增量渲染,文档变化时只更新变化的行,不重新渲染整个文档。使用Web Worker执行耗时操作,比如语法解析、语法高亮,避免阻塞主线程。
